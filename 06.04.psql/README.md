# Домашнее задание к занятию "6.4. PostgreSQL"

## Задача 1

Используя docker поднимите инстанс PostgreSQL (версию 13). Данные БД сохраните в volume.

![](img/task1.1.png)

Подключитесь к БД PostgreSQL используя `psql`.

![](img/task1.2.png)

Воспользуйтесь командой `\?` для вывода подсказки по имеющимся в `psql` управляющим командам.

**Найдите и приведите** управляющие команды для:
- вывода списка БД

![](img/task1.3.png)

- подключения к БД

![](img/task1.4.png)

- вывода списка таблиц

![](img/task1.5.png)

- вывода описания содержимого таблиц

![](img/task1.6.png)

- выхода из psql

![](img/task1.6.png)

## Задача 2

Используя `psql` создайте БД `test_database`.

![](img/task2.1.png)

Восстановите бэкап БД в `test_database`.

![](img/task2.2.png)

Перейдите в управляющую консоль `psql` внутри контейнера.

Подключитесь к восстановленной БД и проведите операцию ANALYZE для сбора статистики по таблице.

![](img/task2.3.png)

Используя таблицу `pg_stats`, найдите столбец таблицы `orders` с наибольшим средним значением 
размера элементов в байтах.

![](img/task2.4.png)


![](img/task2.4.1.png)

## Задача 3

Архитектор и администратор БД выяснили, что ваша таблица orders разрослась до невиданных размеров и
поиск по ней занимает долгое время. Вам, как успешному выпускнику курсов DevOps в нетологии предложили
провести разбиение таблицы на 2 (шардировать на orders_1 - price>499 и orders_2 - price<=499).

Предложите SQL-транзакцию для проведения данной операции.

![](img/task3.1.png)

Можно ли было изначально исключить "ручное" разбиение при проектировании таблицы orders?

```
Если изначально рассмотривался рост таблицы, то на этапе проектирования можно было бы создать 
критерии разделения записей в разные таблицы.
```

## Задача 4

Используя утилиту `pg_dump` создайте бекап БД `test_database`.

![](img/task4.2.png)

Как бы вы доработали бэкап-файл, чтобы добавить уникальность значения столбца `title` для таблиц `test_database`?

```
Можно добавить UNIQUE в файле дампа при создании таблицы orders для столбца title
```

